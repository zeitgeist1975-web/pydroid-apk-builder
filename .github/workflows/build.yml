      - name: Build with Buildozer
        env:
          JAVA_OPTS: "-Xmx2048m"
          GRADLE_OPTS: "-Dorg.gradle.jvmargs=-Xmx2048m"
        run: |
          buildozer android clean || true
          
          # 1. 화면 방향을 'portrait(세로)'로 강제 수정
          sed -i 's/^[# ]*orientation =.*/orientation = portrait/' buildozer.spec
          
          # 2. 필수 라이브러리(PyPDF2, deep_translator 등) 주입 - 이 부분이 없으면 무조건 튕깁니다.
          sed -i 's|^requirements =.*|requirements = python3,kivy==2.2.1,PyPDF2,deep_translator,requests,certifi,urllib3,idna,charset-normalizer,hostpython3|' buildozer.spec
          
          # 3. 권한 설정 주입
          sed -i 's/^[# ]*android.permissions =.*/android.permissions = READ_EXTERNAL_STORAGE,WRITE_EXTERNAL_STORAGE,INTERNET/' buildozer.spec
          
          # 4. 기타 필수 설정
          sed -i 's/^[# ]*version =.*/version = 1.0.0/' buildozer.spec
          sed -i 's/^[# ]*android.archs =.*/android.archs = arm64-v8a/' buildozer.spec
          sed -i 's/^[# ]*android.accept_sdk_license =.*/android.accept_sdk_license = True/' buildozer.spec
          
          export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:.
          yes y | buildozer -v android debug
